{"version":3,"file":"index.js","sources":["../src/constants.ts","../src/loader.ts","../src/types/index.ts","../src/initStytch.ts"],"sourcesContent":["const PUBLIC_URL = 'https://js.stytch.com/stytch.js';\n\nfunction getJSUrl() {\n  try {\n    if (process.env.STYTCH_JS_SDK_URL) {\n      return process.env.STYTCH_JS_SDK_URL;\n    }\n    if (process.env.REACT_APP_STYTCH_JS_SDK_URL) {\n      return process.env.REACT_APP_STYTCH_JS_SDK_URL;\n    }\n    if (process.env.NEXT_PUBLIC_STYTCH_JS_SDK_URL) {\n      return process.env.NEXT_PUBLIC_STYTCH_JS_SDK_URL;\n    }\n    if (process.env.STORYBOOK_STYTCH_JS_SDK_URL) {\n      return process.env.STORYBOOK_STYTCH_JS_SDK_URL;\n    }\n    return PUBLIC_URL;\n  } catch (err) {\n    return PUBLIC_URL;\n  }\n}\n\nexport const STYTCH_JS_URL = getJSUrl();\n","import { StytchFactory } from './types';\nimport { STYTCH_JS_URL } from './constants';\n\nconst findOrCreateScript = (): HTMLScriptElement => {\n  const scripts = document.querySelectorAll<HTMLScriptElement>(`script[src=\"${STYTCH_JS_URL}\"]`);\n\n  if (scripts[0]) {\n    return scripts[0];\n  }\n\n  const script = document.createElement('script');\n  script.src = STYTCH_JS_URL;\n  document.head.appendChild(script);\n  return script;\n};\n\nconst loadScript = (): Promise<StytchFactory | null> => {\n  const isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n\n  if (!isBrowser) {\n    return Promise.resolve(null);\n  }\n\n  return new Promise((resolve, reject) => {\n    if (window.Stytch) {\n      return resolve(window.Stytch);\n    }\n\n    const script = findOrCreateScript();\n\n    script.addEventListener('load', () => {\n      if (window.Stytch) {\n        resolve(window.Stytch);\n      } else {\n        reject(new Error('Stytch.js could not be loaded'));\n      }\n    });\n\n    script.addEventListener('error', () => {\n      reject(new Error('Stytch.js could not be loaded'));\n    });\n  });\n};\n\n// Execute our own script injection after a tick to give users time to do their\n// own script injection.\nconst stytchPromise: Promise<StytchFactory | null> = Promise.resolve().then(() => loadScript());\n\nlet loadCalled = false;\n// We will log a warning if it doesn't look like the host code has checked or invoked the promise\nstytchPromise.catch((err: Error) => {\n  if (!loadCalled) {\n    console.warn(err);\n  }\n});\n\nexport const loadStytch = (): Promise<StytchFactory | null> => {\n  loadCalled = true;\n  return stytchPromise;\n};\n","import { IHeadlessClient } from './headless';\nexport * from './headless';\n\ndeclare global {\n  interface Window {\n    Stytch?: StytchFactory;\n  }\n}\n\nexport type StytchFactory = (publicToken: string, options?: CallbackOptions) => StytchClient;\n\n// Client object types\nexport interface StytchClient extends IHeadlessClient {\n  mount: (mountArgs: StytchMountArgs) => void;\n}\n\nexport interface StytchMountArgs {\n  elementId: string;\n  loginOrSignupView: LoginOrSignupView;\n  style: StyleConfig;\n  callbacks?: CallbackOptions;\n}\n\nexport interface StyleConfig {\n  fontFamily?: string;\n  primaryColor?: string;\n  primaryTextColor?: string;\n  secondaryTextColor?: string;\n  lightGrey?: string;\n  darkGrey?: string;\n  width?: string;\n  hideHeaderText?: boolean;\n}\n\nexport interface EmailMagicLinksOptions {\n  loginRedirectURL: string;\n  loginExpirationMinutes?: number;\n  signupRedirectURL: string;\n  signupExpirationMinutes?: number;\n  createUserAsPending?: boolean;\n}\n\nexport interface LoginOrSignupView {\n  products: SDKProductTypes[];\n  emailMagicLinksOptions?: EmailMagicLinksOptions;\n  oauthOptions?: OAuthOptions;\n  sessionOptions?: SessionOptions;\n  otpOptions?: OTPOptions;\n}\n\n// Callback types\nexport enum EventType {\n  CallbackEvent = 'CALLBACK_EVENT',\n  ErrorEvent = 'ERROR_EVENT',\n  SuccessEvent = 'SUCCESS_EVENT',\n}\n\nexport enum CallbackEventType {\n  UserEventType = 'USER_EVENT_TYPE',\n}\n\nexport interface UserEventData {\n  type: CallbackEventType.UserEventType;\n  email: string;\n  emailId: string;\n  userId: string;\n}\n\nexport interface MagicLinkSentData {\n  message: string;\n}\n\nexport interface StytchError {\n  message: string;\n}\n\nexport interface EventData {\n  eventType: EventType.CallbackEvent;\n  eventData: UserEventData;\n}\n\nexport interface SuccessData {\n  eventType: EventType.SuccessEvent;\n  eventData: MagicLinkSentData;\n}\n\nexport interface ErrorData {\n  eventType: EventType.ErrorEvent;\n  error: StytchError;\n}\n\nexport interface CallbackOptions {\n  onEvent?: (data: EventData) => void;\n  onSuccess?: (data: SuccessData) => void;\n  onError?: (data: ErrorData) => void;\n}\n\nexport enum SDKProductTypes {\n  emailMagicLinks = 'emailMagicLinks',\n  oauth = 'oauth',\n  otp = 'otp',\n  crypto = 'crypto',\n}\n\nexport enum OAuthProvidersTypes {\n  Google = 'google',\n  Microsoft = 'microsoft',\n  Apple = 'apple',\n  Github = 'github',\n  GitLab = 'gitlab',\n  Facebook = 'facebook',\n  Coinbase = 'coinbase',\n  Discord = 'discord',\n  Slack = 'slack',\n  Amazon = 'amazon',\n  Bitbucket = 'bitbucket',\n  LinkedIn = 'linkedin',\n  Twitch = 'twitch',\n}\n\nexport enum OneTapPositions {\n  embedded = 'embedded',\n  floating = 'floating',\n}\n\nexport type OAuthProvider =\n  | {\n      type: OAuthProvidersTypes;\n      custom_scopes?: string[];\n    }\n  | {\n      type: OAuthProvidersTypes.Google;\n      one_tap: true;\n      position: OneTapPositions;\n    };\n\nexport type OAuthOptions = {\n  loginRedirectURL?: string;\n  signupRedirectURL?: string;\n  providers: OAuthProvider[];\n};\n\nexport type SessionOptions = {\n  sessionDurationMinutes: number;\n};\n\nexport enum OTPMethods {\n  SMS = 'sms',\n  WhatsApp = 'whatsapp',\n  Email = 'email',\n}\n\nexport type OTPOptions = {\n  methods: Array<OTPMethods>;\n  expirationMinutes: number;\n};\n","import { loadStytch } from './loader';\nimport { StytchClient, StytchFactory } from './types';\n\nexport const initStytch = (...args: Parameters<StytchFactory>): StytchClient | null => {\n  if (typeof window === 'undefined') {\n    return null;\n  }\n  if (!window.Stytch) {\n    throw new Error(`Stytch has not been loaded.\nMake sure the script tag exists in the document head:\n\\`\\`\\`\n<script src=\"https://js.stytch.com/stytch.js\"></script>\n\\`\\`\\`\n\nIf using Next.js be sure to load Stytch using the beforeInteractive strategy in pages/_app.jsx:\n\\`\\`\\`\nimport Script from 'next/script';\n...\n<Script src=\"https://js.stytch.com/stytch.js\" strategy=\"beforeInteractive\" />\n\\`\\`\\`\n`);\n  }\n  return window.Stytch(...args);\n};\n\nexport const loadAndInitStytch = (...args: Parameters<StytchFactory>): Promise<StytchClient | null> =>\n  loadStytch().then((stytchFactory) => stytchFactory && stytchFactory(...args));\n"],"names":["EventType","CallbackEventType","SDKProductTypes","OAuthProvidersTypes","OneTapPositions","OTPMethods"],"mappings":"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"}